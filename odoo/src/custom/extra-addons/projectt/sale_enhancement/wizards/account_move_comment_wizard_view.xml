<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- Wizard Form -->
    <record id="view_wizard_account_move_line_description" model="ir.ui.view">
        <field name="name">wizard.account.move.line.description.form</field>
        <field name="model">wizard.account.move.line.description</field>
        <field name="arch" type="xml">
            <form string="Add Description">
                <group>
                    <field name="description"/>
                </group>
                <footer>
                    <button string="Apply"
                            type="object"
                            name="apply_description"
                            class="btn-primary"/>
                    <button string="Cancel" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action -->
    <record id="action_wizard_account_move_line_description" model="ir.actions.act_window">
        <field name="name">Add Description</field>
        <field name="res_model">wizard.account.move.line.description</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <!-- Corrected View Inherit: account.move.line tree -->
    <record id="view_move_form_inherit_description" model="ir.ui.view">
        <field name="name">account.move.form.inherit.description</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='price_subtotal']"
                   position="after">
                <button name="open_description_wizard"
                        type="object"
                        string=""
                        icon="fa-regular fa-comment"
                />
            </xpath>
        </field>
    </record>

    <!-- Extend search view of account.move -->

    <record id="view_account_move_search_groupby_partner" model="ir.ui.view">
        <field name="name">account.move.search.inherit.groupby.partner</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">

            <!-- Insert as the first group filter in the search view -->
            <xpath expr="//group[1]" position="inside">
                <filter string="Partner" name="group_partner"
                        context="{'group_by': 'partner_id'}"/>
            </xpath>

        </field>
    </record>

</odoo>
